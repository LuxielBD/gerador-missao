<!DOCTYPE html>

<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gerador Ordo Realitas</title>
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#1f2937" />

  <style>
    body { font-family: Arial, sans-serif; background:#111827; color:#e5e7eb; margin:0; padding:20px; }
    h1,h2 { color:#f9fafb; }
    .card { background:#1f2937; border-radius:12px; padding:16px; margin-bottom:16px; box-shadow:0 4px 10px rgba(0,0,0,.4); }
    button { background:#2563eb; border:none; padding:12px 18px; color:white; border-radius:8px; cursor:pointer; font-size:16px; }
    button:hover { background:#1d4ed8; }
    .story { font-size:18px; line-height:1.5; }
    .highlight { color:#93c5fd; font-weight:bold; }
  </style>
</head>
<body>

<h1>Gerador de Miss√µes ‚Äì Ordo Realitas</h1>

<div class="card">
  <button id="btnGerar">üé≤ Gerar Miss√£o Autom√°tica</button>
</div>

<div class="card story" id="historia">
  Clique no bot√£o para gerar uma miss√£o.
</div>

<div class="card" id="detalhes">
  <h2>Detalhes Revelados</h2>
  <div id="detalhesTexto">Nenhum detalhe revelado ainda.</div>
</div>

<script>
/********************
 * FUN√á√ïES B√ÅSICAS
 ********************/
function rolar(lista) {
  return lista[Math.floor(Math.random() * lista.length)];
}

function rolarCombinado(lista, marcador) {
  const limpa = lista.filter(l => l !== marcador);
  const primeiro = rolar(limpa);
  const segundo = rolar(limpa.filter(l => l !== primeiro));
  return `${primeiro} e ${segundo}`;
}

/********************
 * TABELAS DE ROLAGEM
 ********************/
const tabelas = {
  sujeito: [
    'inocente curioso',
    'criminoso',
    'pessoa influente (magnata, pol√≠tico...)',
    'bando cultista',
    'cultista independente',
    'ex-agente da Ordo Realitas',
    'item amaldi√ßoado',
    'criatura paranormal'
  ],
  acao: [
    'invocou uma criatura de prop√≥sito',
    'invocou uma criatura sem querer',
    'est√° sequestrando inocentes',
    'est√° assassinando inocentes',
    'est√° usando um ritual item amaldi√ßoado para cometer crimes mundanos (roubo, extors√£o...)',
    'est√° recrutando cultistas',
    'est√° pesquisando um ritual perigoso',
    'est√° coletando itens amaldi√ßoados',
    'matou um agente da Ordo Realitas',
    'acao combinada*'
  ],
  local: [
    'escola','hospital','vilarejo','fazenda','mata fechada','becos de metr√≥pole','arranha-c√©u',
    'grande loja de departamento','esgoto','zona industrial da cidade','shopping center','orfanato',
    'museu','cemit√©rio','delegacia ou base militar','mans√£o','antiga sede da Ordo Realitas','navio','ilha remota',
    'local combinado*'
  ],
  amigo: [
    'civil alheio ao paranormal',
    'civil exposto ao paranormal',
    'antigo conhecido dos agentes',
    'agente da Ordo Realitas'
  ],
  objeto: [
    'equipamento',
    'ingrediente para um ritual poderoso (m√°scara ritual√≠stica, gema rara...)',
    `equipamento modificado com <strong>${rolar([1,2,3]) - 1}</strong> modifica√ß√µes`,
    'artefato com grande valor para a Ordo Realitas (tomo antigo, rel√≠quia ancestral...)',
    'item amaldi√ßoado',
    'objeto combinado*'
  ],
  evento: [
    'o aparecimento de uma/outra criatura paranormal de grande poder',
    'a chegada de refor√ßos inimigos',
    'uma doen√ßa paranormal/maldi√ß√£o afetando o aliado',
    'civis se revoltando contra eles',
    'a revela√ß√£o de que o aliado era o vil√£o',
    'a descoberta de que as a√ß√µes do inimigo eram justificadas',
    'a perda de seus equipamentos (por furto, falhas tecnol√≥gicas...)',
    'ter que proteger um civil',
    'a perda de comunica√ß√£o com a Ordo Realitas e acesso ao sistema de cr√©dito',
    'agentes da lei os importunando',
    'um desastre em grande escala (inc√™ndio, tempestade, furac√£o, agita√ß√£o civil...)',
    'o aparecimento de um antigo inimigo'
  ]
};

/********************
 * GERADOR PRINCIPAL
 ********************/
function gerarHistoria() {
  const r = {
    sujeito: rolar(tabelas.sujeito),
    acao: null,
    amigo: rolar(tabelas.amigo),
    local: null,
    objeto: null,
    evento: rolar(tabelas.evento)
  };

  const acaoSorteada = rolar(tabelas.acao);
  r.acao = acaoSorteada === 'acao combinada*'
    ? rolarCombinado(tabelas.acao, 'acao combinada*')
    : acaoSorteada;

  const localSorteado = rolar(tabelas.local);
  r.local = localSorteado === 'local combinado*'
    ? rolarCombinado(tabelas.local, 'local combinado*')
    : localSorteado;

  const objetoSorteado = rolar(tabelas.objeto);
  r.objeto = objetoSorteado === 'objeto combinado*'
    ? rolarCombinado(tabelas.objeto, 'objeto combinado*')
    : objetoSorteado;

  document.getElementById('historia').innerHTML = `
    Um(a) <span class="highlight">${r.sujeito}</span>
    <span class="highlight">${r.acao}</span> em um(a)
    <span class="highlight">${r.local}</span>. Durante a investiga√ß√£o, o grupo ter√° a ajuda de um(a)
    <span class="highlight">${r.amigo}</span> e poder√° encontrar 
    <span class="highlight">${r.objeto}</span>. Por√©m, em determinado momento, os agentes ser√£o surpreendidos por
    <span class="highlight">${r.evento}</span>.
  `;

  gerarDetalhes(r);
}

/********************
 * DETALHES CONTEXTUAIS
 ********************/
function gerarDetalhes(r) {
  const detalhes = [];

  function paraCadaParte(valor, fn) {
    valor.split(' e ').forEach(v => fn(v.trim()));
  }

  if (r.sujeito.includes('criatura')) {
    detalhes.push(`A criatura √© do elemento <strong>${rolar(['Sangue','Morte','Conhecimento','Energia'])}</strong>.`);
  }

  const criaturainv = [
    'invocou uma criatura de prop√≥sito',
    'invocou uma criatura sem querer'
  ];

  paraCadaParte(r.acao, parte => {
    if (criaturainv.some(l => parte.includes(l))) {
      detalhes.push(`A criatura invocada √© do elemento <strong>${rolar(['Sangue','Morte','Conhecimento','Energia'])}</strong>.`);
    }
  });

  const locaisHabitados = [
    'escola','hospital','vilarejo','fazenda','arranha-c√©u','grande loja de departamento',
    'zona industrial da cidade','shopping center','orfanato','museu','mans√£o','navio'
  ];

  paraCadaParte(r.local, parte => {
    if (locaisHabitados.some(l => parte.includes(l))) {
      detalhes.push(`O local (${parte}) est√° <strong>${rolar(['abandonado','habitado'])}</strong>.`);
    }
  });

  if (r.amigo.includes('Ordo Realitas')) {
    detalhes.push(`O agente aliado est√° <strong>${rolar(['em atividade','aposentado'])}</strong>.`);
  }

  const objetosEquipamento = [
    'equipamento','equipamento modificado','item amaldi√ßoado'
  ];

  paraCadaParte(r.objeto, parte => {
    if (objetosEquipamento.some(o => parte.includes(o))) {
      detalhes.push(`O item (${parte}) √© <strong>${rolar(['uma arma','uma prote√ß√£o','um equipamento geral/acess√≥rio'])}</strong>.`);
    }
  });

  if (r.evento.includes('criatura')) {
    detalhes.push(`A criatura que aparece √© do elemento <strong>${rolar(['Sangue','Morte','Conhecimento','Energia'])}</strong>.`);
  }

  document.getElementById('detalhesTexto').innerHTML = detalhes.length
    ? detalhes.join('<br><br>')
    : 'Nenhum detalhe adicional foi revelado nesta rolagem.';
}

/********************
 * EVENTO DO BOT√ÉO
 ********************/
document.getElementById('btnGerar').addEventListener('click', gerarHistoria);

/********************
 * SERVICE WORKER
 ********************/
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js');
}
</script>

</body>
</html>
